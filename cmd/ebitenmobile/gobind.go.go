// Code generated by file2byteslice. DO NOT EDIT.
// (gofmt is fine after generating)

package main

var gobind_go = []byte("// Copyright 2019 The Ebiten Authors\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n// +build ebitenmobilegobind\n\n// gobind is a wrapper of the original gobind. This command adds extra files like a view controller.\npackage main\n\nimport (\n\t\"flag\"\n\t\"fmt\"\n\t\"io/ioutil\"\n\t\"log\"\n\t\"os\"\n\t\"os/exec\"\n\t\"path/filepath\"\n\t\"strings\"\n\n\t\"golang.org/x/tools/go/packages\"\n)\n\nvar (\n\tlang          = flag.String(\"lang\", \"\", \"\")\n\toutdir        = flag.String(\"outdir\", \"\", \"\")\n\tjavaPkg       = flag.String(\"javapkg\", \"\", \"\")\n\tprefix        = flag.String(\"prefix\", \"\", \"\")\n\tbootclasspath = flag.String(\"bootclasspath\", \"\", \"\")\n\tclasspath     = flag.String(\"classpath\", \"\", \"\")\n\ttags          = flag.String(\"tags\", \"\", \"\")\n)\n\nvar usage = `The Gobind tool generates Java language bindings for Go.\n\nFor usage details, see doc.go.`\n\nfunc main() {\n\tflag.Parse()\n\tif err := run(); err != nil {\n\t\tlog.Fatal(err)\n\t}\n}\n\nfunc invokeOriginalGobind(lang string) (pkgName string, err error) {\n\tcmd := exec.Command(\"gobind-original\", os.Args[1:]...)\n\tcmd.Stdout = os.Stdout\n\tcmd.Stderr = os.Stderr\n\tif err := cmd.Run(); err != nil {\n\t\treturn \"\", err\n\t}\n\n\tcfgtags := strings.Join(strings.Split(*tags, \",\"), \" \")\n\tcfg := &packages.Config{}\n\tswitch lang {\n\tcase \"java\":\n\t\tcfg.Env = append(os.Environ(), \"GOOS=android\")\n\tcase \"objc\":\n\t\tcfg.Env = append(os.Environ(), \"GOOS=darwin\")\n\t\tif cfgtags != \"\" {\n\t\t\tcfgtags += \" \"\n\t\t}\n\t\tcfgtags += \"ios\"\n\t}\n\tcfg.BuildFlags = []string{\"-tags\", cfgtags}\n\tpkgs, err := packages.Load(cfg, flag.Args()[0])\n\tif err != nil {\n\t\treturn \"\", err\n\t}\n\treturn pkgs[0].Name, nil\n}\n\nfunc run() error {\n\treadFile := func(filename string) ([]byte, error) {\n\t\tcontent, err := ioutil.ReadFile(filepath.Join(*outdir, filename))\n\t\tif err != nil {\n\t\t\treturn nil, err\n\t\t}\n\t\treturn content, nil\n\t}\n\n\twriteFile := func(filename string, content []byte) error {\n\t\tif err := ioutil.WriteFile(filepath.Join(*outdir, filename), content, 0644); err != nil {\n\t\t\treturn err\n\t\t}\n\t\treturn nil\n\t}\n\n\t// Add additional files.\n\tlangs := strings.Split(*lang, \",\")\n\tfor _, lang := range langs {\n\t\tpkgName, err := invokeOriginalGobind(lang)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\tprefixLower := *prefix + pkgName\n\t\tprefixUpper := strings.Title(*prefix) + strings.Title(pkgName)\n\t\treplacePrefixes := func(content string) string {\n\t\t\tcontent = strings.ReplaceAll(content, \"{{.PrefixUpper}}\", prefixUpper)\n\t\t\tcontent = strings.ReplaceAll(content, \"{{.PrefixLower}}\", prefixLower)\n\t\t\tcontent = strings.ReplaceAll(content, \"{{.JavaPkg}}\", *javaPkg)\n\t\t\treturn content\n\t\t}\n\n\t\tswitch lang {\n\t\tcase \"objc\":\n\t\t\tif err := writeFile(filepath.Join(\"src\", \"gobind\", prefixLower+\"ebitenviewcontroller_ios.m\"), []byte(replacePrefixes(objcM))); err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\t\tcase \"java\":\n\t\t\tdir := filepath.Join(strings.Split(*javaPkg, \".\")...)\n\t\t\tdir = filepath.Join(dir, prefixLower)\n\t\t\tif err := writeFile(filepath.Join(\"java\", dir, \"EbitenView.java\"), []byte(replacePrefixes(viewJava))); err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\t\t\tif err := writeFile(filepath.Join(\"java\", dir, \"EbitenSurfaceView.java\"), []byte(replacePrefixes(surfaceViewJava))); err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\n\t\t\t// Use CoffeeCatch (https://github.com/xroche/coffeecatch)\n\t\t\tbinding, err := readFile(filepath.Join(\"src\", \"gobind\", \"ebitenmobileview_android.c\"))\n\t\t\tif err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\t\t\tif err := writeFile(filepath.Join(\"src\", \"gobind\", \"ebitenmobileview_android.c\"), []byte(addCoffeeCatch(string(binding)))); err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\t\tcase \"go\":\n\t\t\tif err := writeFile(filepath.Join(\"src\", \"gobind\", \"coffeecatch.c\"), coffeecatch_c); err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\t\t\tif err := writeFile(filepath.Join(\"src\", \"gobind\", \"coffeecatch.h\"), coffeecatch_h); err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\t\t\tif err := writeFile(filepath.Join(\"src\", \"gobind\", \"coffeejni.c\"), coffeejni_c); err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\t\t\tif err := writeFile(filepath.Join(\"src\", \"gobind\", \"coffeejni.h\"), coffeejni_h); err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\t\t\tif err := writeFile(filepath.Join(\"src\", \"gobind\", \"cgoflags.go\"), []byte(cgoFlagsGo)); err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\n\t\tdefault:\n\t\t\tpanic(fmt.Sprintf(\"unsupported language: %s\", lang))\n\t\t}\n\t}\n\n\treturn nil\n}\n\nfunc addInclude(src string, filename string) string {\n\tidx0 := strings.LastIndex(src, \"#include \")\n\tidx1 := strings.Index(src[idx0:], \"\\n\") + idx0\n\treturn src[:idx1] + \"\\n#include \\\"\" + filename + \"\\\"\" + src[idx1:]\n}\n\nfunc addCoffeeCatch(src string) string {\n\tsrc = addInclude(src, \"coffeecatch.h\")\n\tsrc = addInclude(src, \"coffeejni.h\")\n\n\tconst sig = \"ebitenmobileview_Ebitenmobileview_update(JNIEnv* env, jclass _clazz) {\"\n\tidx0 := strings.Index(src, sig) + len(sig)\n\tidx1 := strings.Index(src[idx0:], \"}\") + idx0\n\tp0 := src[:idx0]\n\tp1 := src[idx0:idx1]\n\tp2 := src[idx1:]\n\n\tconst coffeeCatchPre = `\n\tCOFFEE_TRY() {\n`\n\tconst coffeeCatchPost = `\n\t} COFFEE_CATCH() {\n\t\tcoffeecatch_throw_exception(env);\n\t} COFFEE_END();\n`\n\treturn p0 + coffeeCatchPre + p1 + coffeeCatchPost + p2\n}\n\nconst cgoFlagsGo = `// Code generated by ebitenmobile. DO NOT EDIT.\n\npackage main\n\n// #cgo CFLAGS: -D_REENTRANT\nimport \"C\"\n`\n\nconst objcM = `// Code generated by ebitenmobile. DO NOT EDIT.\n\n// +build ios\n\n#import <stdint.h>\n#import <UIKit/UIKit.h>\n#import <GLKit/GLkit.h>\n#import \"Ebitenmobileview.objc.h\"\n\n@interface {{.PrefixUpper}}EbitenViewController : UIViewController\n@end\n\n@implementation {{.PrefixUpper}}EbitenViewController {\n  GLKView* glkView_;\n  bool     started_;\n  bool     active_;\n  bool     error_;\n}\n\n- (GLKView*)glkView {\n  if (!glkView_) {\n    glkView_ = [[GLKView alloc] init];\n    glkView_.multipleTouchEnabled = YES;\n  }\n  return glkView_;\n}\n\n- (void)viewDidLoad {\n  [super viewDidLoad];\n\n  if (!started_) {\n    @synchronized(self) {\n      active_ = true;\n    }\n    started_ = true;\n  }\n\n  self.glkView.delegate = (id<GLKViewDelegate>)(self);\n  [self.view addSubview: self.glkView];\n\n  EAGLContext *context = [[EAGLContext alloc] initWithAPI:kEAGLRenderingAPIOpenGLES2];\n  [self glkView].context = context;\n\t\n  [EAGLContext setCurrentContext:context];\n\t\n  CADisplayLink *displayLink = [CADisplayLink displayLinkWithTarget:self selector:@selector(drawFrame)];\n  [displayLink addToRunLoop:[NSRunLoop currentRunLoop] forMode:NSDefaultRunLoopMode];\n}\n\n- (void)viewDidLayoutSubviews {\n  [super viewDidLayoutSubviews];\n  CGRect viewRect = [[self view] frame];\n\n  EbitenmobileviewLayout(viewRect.size.width, viewRect.size.height, (id<EbitenmobileviewViewRectSetter>)self);\n}\n\n- (void)setViewRect:(long)x y:(long)y width:(long)width height:(long)height {\n  CGRect glkViewRect = CGRectMake(x, y, width, height);\n  [[self glkView] setFrame:glkViewRect];\n}\n\n- (void)didReceiveMemoryWarning {\n  [super didReceiveMemoryWarning];\n  // Dispose of any resources that can be recreated.\n  // TODO: Notify this to Go world?\n}\n\n- (void)drawFrame {\n  @synchronized(self) {\n    if (!active_) {\n      return;\n    }\n\n    [[self glkView] setNeedsDisplay];\n  }\n}\n\n- (void)glkView:(GLKView*)view drawInRect:(CGRect)rect {\n  @synchronized(self) {\n    if (error_) {\n      return;\n    }\n    NSError* err = nil;\n    EbitenmobileviewUpdate(&err);\n    if (err != nil) {\n      [self performSelectorOnMainThread:@selector(onErrorOnGameUpdate:)\n                             withObject:err\n                          waitUntilDone:NO];\n      error_ = true;\n    }\n  }\n}\n\n- (void)onErrorOnGameUpdate:(NSError*)err {\n  NSLog(@\"Error: %@\", err);\n}\n\n- (void)updateTouches:(NSSet*)touches {\n  for (UITouch* touch in touches) {\n    if (touch.view != [self glkView]) {\n      continue;\n    }\n    CGPoint location = [touch locationInView:touch.view];\n    EbitenmobileviewUpdateTouchesOnIOS(touch.phase, (uintptr_t)touch, location.x, location.y);\n  }\n}\n\n- (void)touchesBegan:(NSSet*)touches withEvent:(UIEvent*)event {\n  [self updateTouches:touches];\n}\n\n- (void)touchesMoved:(NSSet*)touches withEvent:(UIEvent*)event {\n  [self updateTouches:touches];\n}\n\n- (void)touchesEnded:(NSSet*)touches withEvent:(UIEvent*)event {\n  [self updateTouches:touches];\n}\n\n- (void)touchesCancelled:(NSSet*)touches withEvent:(UIEvent*)event {\n  [self updateTouches:touches];\n}\n\n- (void)suspendGame {\n  NSAssert(started_, @\"suspendGame msut not be called before viewDidLoad is called\");\n\n  @synchronized(self) {\n    active_ = false;\n  }\n}\n\n- (void)resumeGame {\n  NSAssert(started_, @\"resumeGame msut not be called before viewDidLoad is called\");\n\n  @synchronized(self) {\n    active_ = true;\n  }\n}\n\n@end\n`\n\nconst viewJava = `// Code generated by ebitenmobile. DO NOT EDIT.\n\npackage {{.JavaPkg}}.{{.PrefixLower}};\n\nimport android.content.Context;\nimport android.os.Handler;\nimport android.os.Looper;\nimport android.util.AttributeSet;\nimport android.util.Log;\nimport android.view.ViewGroup;\n\nimport {{.JavaPkg}}.ebitenmobileview.Ebitenmobileview;\nimport {{.JavaPkg}}.ebitenmobileview.ViewRectSetter;\n\npublic class EbitenView extends ViewGroup {\n    private double getDeviceScale() {\n        if (deviceScale_ == 0.0) {\n            deviceScale_ = getResources().getDisplayMetrics().density;\n        }\n        return deviceScale_;\n    }\n\n    private double pxToDp(double x) {\n        return x / getDeviceScale();\n    }\n\n    private double dpToPx(double x) {\n        return x * getDeviceScale();\n    }\n\n    private double deviceScale_ = 0.0;\n\n    public EbitenView(Context context) {\n        super(context);\n        ebitenSurfaceView_ = new EbitenSurfaceView(context);\n    }\n\n    public EbitenView(Context context, AttributeSet attrs) {\n        super(context, attrs);\n        ebitenSurfaceView_ = new EbitenSurfaceView(context, attrs);\n    }\n\n    @Override\n    protected void onLayout(boolean changed, int left, int top, int right, int bottom) {\n        if (!initialized_) {\n            LayoutParams params = new LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT);\n            addView(ebitenSurfaceView_, params);\n            initialized_ = true;\n        }\n\n        int widthInDp = (int)Math.floor(pxToDp(right - left));\n        int heightInDp = (int)Math.floor(pxToDp(bottom - top));\n        Ebitenmobileview.layout(widthInDp, heightInDp, new ViewRectSetter() {\n            @Override\n            public void setViewRect(long xInDp, long yInDp, long widthInDp, long heightInDp) {\n                final int widthInPx = (int)Math.ceil(dpToPx(widthInDp));\n                final int heightInPx = (int)Math.ceil(dpToPx(heightInDp));\n                final int xInPx = (int)Math.ceil(dpToPx(xInDp));\n                final int yInPx = (int)Math.ceil(dpToPx(yInDp));\n                new Handler(Looper.getMainLooper()).post(new Runnable() {\n                    @Override\n                    public void run() {\n                        ebitenSurfaceView_.layout(xInPx, yInPx, xInPx + widthInPx, yInPx + heightInPx);\n                    }\n                });\n            }\n        });\n    }\n\n    // suspendGame suspends the game.\n    // It is recommended to call this when the application is being suspended e.g.,\n    // Activity's onPause is called.\n    public void suspendGame() {\n        if (initialized_) {\n            ebitenSurfaceView_.onPause();\n        }\n    }\n\n    // resumeGame resumes the game.\n    // It is recommended to call this when the application is being resumed e.g.,\n    // Activity's onResume is called.\n    public void resumeGame() {\n        if (initialized_) {\n            ebitenSurfaceView_.onResume();\n        }\n    }\n\n    // onErrorOnGameUpdate is called on the main thread when an error happens when updating a game.\n    // You can define your own error handler, e.g., using Crashlytics, by overwriting this method.\n    protected void onErrorOnGameUpdate(Exception e) {\n        Log.e(\"Go\", e.toString());\n    }\n\n    private EbitenSurfaceView ebitenSurfaceView_;\n    private boolean initialized_ = false;\n}\n`\n\nconst surfaceViewJava = `// Code generated by ebitenmobile. DO NOT EDIT.\n\npackage {{.JavaPkg}}.{{.PrefixLower}};\n\nimport android.content.Context;\nimport android.opengl.GLSurfaceView;\nimport android.os.Handler;\nimport android.os.Looper;\nimport android.util.AttributeSet;\nimport android.view.MotionEvent;\n\nimport javax.microedition.khronos.egl.EGLConfig;\nimport javax.microedition.khronos.opengles.GL10;\n\nimport {{.JavaPkg}}.ebitenmobileview.Ebitenmobileview;\nimport {{.JavaPkg}}.{{.PrefixLower}}.EbitenView;\n\nclass EbitenSurfaceView extends GLSurfaceView {\n\n    private class EbitenRenderer implements GLSurfaceView.Renderer {\n\n        private boolean errored_ = false;\n\n        @Override\n        public void onDrawFrame(GL10 gl) {\n            if (errored_) {\n                return;\n            }\n            try {\n                Ebitenmobileview.update();\n            } catch (final Exception e) {\n                new Handler(Looper.getMainLooper()).post(new Runnable() {\n                    @Override\n                    public void run() {\n                        onErrorOnGameUpdate(e);\n                    }\n                });\n                errored_ = true;\n            }\n        }\n\n        @Override\n        public void onSurfaceCreated(GL10 gl, EGLConfig config) {\n        }\n\n        @Override\n        public void onSurfaceChanged(GL10 gl, int width, int height) {\n        }\n    }\n\n    public EbitenSurfaceView(Context context) {\n        super(context);\n        initialize();\n    }\n\n    public EbitenSurfaceView(Context context, AttributeSet attrs) {\n        super(context, attrs);\n        initialize();\n    }\n\n    private void initialize() {\n        setEGLContextClientVersion(2);\n        setEGLConfigChooser(8, 8, 8, 8, 0, 0);\n        setRenderer(new EbitenRenderer());\n    }\n\n    private double getDeviceScale() {\n        if (deviceScale_ == 0.0) {\n            deviceScale_ = getResources().getDisplayMetrics().density;\n        }\n        return deviceScale_;\n    }\n\n    private double pxToDp(double x) {\n        return x / getDeviceScale();\n    }\n\n    @Override\n    public boolean onTouchEvent(MotionEvent e) {\n        for (int i = 0; i < e.getPointerCount(); i++) {\n            int id = e.getPointerId(i);\n            int x = (int)e.getX(i);\n            int y = (int)e.getY(i);\n            Ebitenmobileview.updateTouchesOnAndroid(e.getActionMasked(), id, (int)pxToDp(x), (int)pxToDp(y));\n        }\n        return true;\n    }\n\n    private void onErrorOnGameUpdate(Exception e) {\n        ((EbitenView)getParent()).onErrorOnGameUpdate(e);\n    }\n\n    private double deviceScale_ = 0.0;\n}\n`\n")
